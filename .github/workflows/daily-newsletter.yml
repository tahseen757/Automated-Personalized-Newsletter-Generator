name: Daily Newsletter Run

on:
  schedule:
    - cron: '0 3 * * *'  # Runs at 09:00 AM Dhaka time (03:00 UTC). Change if needed.
  workflow_dispatch:  # Lets you run it manually for tests

jobs:
  run-newsletter:
    runs-on: ubuntu-latest  # Uses a free Linux computer

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'  # Matches your Python version

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run newsletter script
        env:  # Loads your secrets safely
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
          SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
          SERVICE_ACCOUNT_JSON: ${{ secrets.SERVICE_ACCOUNT_JSON }}
        run: python autonews.py

      - name: Archive logs  # Saves logs for you to download if needed
        if: always()  # Runs even if there's an error
        uses: actions/upload-artifact@v4
        with:
          name: logs
          path: newsletter_log.txt
